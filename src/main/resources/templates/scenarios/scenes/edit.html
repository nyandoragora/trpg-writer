<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <head>
        <div th:replace="~{fragment :: meta}"></div>

        <div th:replace="~{fragment :: styles}"></div>

        <title>シーン編集ページ</title>
    </head>
    <body>
        <div class="trpg-wrapper">
           <div th:replace="~{fragment :: header}"></div>

            <main>
              <div th:if="${successMessage}" class="container trpg-container pt-2">
                <div class="alert alert-info mt-4 mb-0">
                  <span th:text="${successMessage}"></span>
                </div>
              </div>

              <div class="container-fluid py-4">
                <div class="row">
                  <!-- Left Pane: Scene Preview & Tabs -->
                  <div class="col-lg-4">
                    <div class="card mb-4">
                      <div class="card-header">シーンプレビュー</div>
                      <div class="card-body" style="min-height: 200px; background-color: #f8f9fa;">
                        <!-- Background Image Preview -->
                        <div th:if="${scene.imagePath}" style="width: 100%; height: 150px; background-size: cover; background-position: center;" th:styleappend="'background-image: url(' + ${scene.imagePath} + ');'"></div>
                        <h5 class="card-title mt-3" th:text="${scene.title}"></h5>
                        <p class="card-text">情報数: [未実装]</p>
                        <p class="card-text">KP向け情報: [未実装]</p>
                      </div>
                    </div>

                    <div class="card mb-4">
                      <div class="card-header">管理項目</div>
                      <div class="card-body">
                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                          <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="npc-tab" data-bs-toggle="tab" data-bs-target="#npc" type="button" role="tab" aria-controls="npc" aria-selected="true">NPC</button>
                          </li>
                          <li class="nav-item" role="presentation">
                            <button class="nav-link" id="info-kp-tab" data-bs-toggle="tab" data-bs-target="#info-kp" type="button" role="tab" aria-controls="info-kp" aria-selected="false">情報 KP</button>
                          </li>
                          <li class="nav-item" role="presentation">
                            <button class="nav-link" id="info-pl-tab" data-bs-toggle="tab" data-bs-target="#info-pl" type="button" role="tab" aria-controls="info-pl" aria-selected="false">情報 PL</button>
                          </li>
                          <li class="nav-item" role="presentation">
                            <button class="nav-link" id="background-tab" data-bs-toggle="tab" data-bs-target="#background" type="button" role="tab" aria-controls="background" aria-selected="false">背景挿入</button>
                          </li>
                        </ul>
                        <div class="tab-content" id="myTabContent">
                          <div class="tab-pane fade show active" id="npc" role="tabpanel" aria-labelledby="npc-tab">
                            <!-- NPC管理コンテンツ -->
                            <p class="mt-3">NPC管理エリア（未実装）</p>
                          </div>
                          <div class="tab-pane fade" id="info-kp" role="tabpanel" aria-labelledby="info-kp-tab">
                            <!-- 情報 KP管理コンテンツ -->
                            <p class="mt-3">情報 KP管理エリア（未実装）</p>
                          </div>
                          <div class="tab-pane fade" id="info-pl" role="tabpanel" aria-labelledby="info-pl-tab">
                            <!-- 情報 PL管理コンテンツ -->
                            <p class="mt-3">情報 PL管理エリア（未実装）</p>
                          </div>
                          <div class="tab-pane fade" id="background" role="tabpanel" aria-labelledby="background-tab">
                            <!-- 背景挿入コンテンツ -->
                            <div class="mt-3">
                              <form th:action="@{/scenarios/{scenarioId}/scenes/{sceneId}/uploadImage(scenarioId=${scenario.id}, sceneId=${scene.id})}" method="post" enctype="multipart/form-data">
                                <div class="mb-3">
                                  <label for="imageFile" class="form-label">背景画像アップロード</label>
                                  <input class="form-control" type="file" id="imageFile" name="imageFile">
                                </div>
                                <button type="submit" class="btn btn-primary">アップロード</button>
                              </form>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Right Pane: Scene Content Editor & Lists -->
                  <div class="col-lg-8">
                    <div class="card mb-4">
                      <div class="card-header">シーン内容編集</div>
                      <div class="card-body">
                        <form th:action="@{/scenarios/{scenarioId}/scenes/{sceneId}/update(scenarioId=${scenario.id}, sceneId=${scene.id})}" method="post">
                          <div class="mb-3">
                            <label for="sceneTitle" class="form-label">シーンタイトル</label>
                            <input type="text" class="form-control" id="sceneTitle" th:field="${scene.title}">
                          </div>
                          <div class="mb-3">
                            <label for="sceneContent" class="form-label">シーン本文</label>
                            <textarea class="form-control" id="sceneContent" th:field="${scene.content}" rows="15"></textarea>
                          </div>
                          <button type="submit" class="btn btn-success">シーンを保存</button>
                        </form>
                      </div>
                    </div>

                    <div class="card mb-4">
                      <div class="card-header">シーンに紐づく情報</div>
                      <div class="card-body">
                        <p>情報リストエリア（未実装）</p>
                      </div>
                    </div>

                    <div class="card">
                      <div class="card-header">シーンに紐づくNPC</div>
                      <div class="card-body">
                        <p>NPCリストエリア（未実装）</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </main>

            <div th:replace="~{fragment :: footer}"></div>
        </div>

        <div th:replace="~{fragment :: scripts}"></div>

        <!-- Swiper -->
        <script src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>
    </body>
</html>
